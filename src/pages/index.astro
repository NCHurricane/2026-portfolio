---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import videos from '../data/videos.json';
import photos from '../data/photos.json';
import ClientLogos from '../components/ClientLogos.astro';

// Select Top 3 Videos & Photos
const featuredVideoIds = ['2024-showreel', 'crosspointe-15', 'farming-drone'];
const featuredVideos = videos.filter(p => featuredVideoIds.includes(p.id));

const featuredPhotoIds = ['1', '4', '3']; // Update with actual IDs from photos.json
const featuredPhotos = photos.filter(p => featuredPhotoIds.includes(String(p.id))).slice(0, 3);
---

<Layout title="Chuck Copeland | Digital Creator & Video Editor">

	<div class="index-page">
	<section class="hero">
		<video autoplay muted loop playsinline class="hero-video" poster="/assets/img/hero-fallback.webp">
			<source src="/assets/video/hero.mp4" type="video/mp4" />
		</video>
		<div class="hero-overlay"></div>
		<div class="hero-content container">
			<h1 transition:name="hero-name">Chuck Copeland</h1>
			<span class="text-accent">
				<h2>Digital Creator</h2>
			</span>
			<h3 class="hero-subtitle">Video Production &bull; Motion Graphics &bull; Web Development &bull; Photography <br />CatDad</h3>
			<div class="hero-actions">
				<a href="#video" class="btn-primary">Featured Media <i class="fas fa-chevron-down"></i></a>
			</div>
		</div>
	</section>

	<section class="trusted-section reveal">
		<div class="container">
			<div class="section-header">
			<h2>Current and Past Clients</h2>
			</div>
			<ClientLogos />
		</div>
	</section>

	<section id="video" class="featured-section reveal">
		<div class="container">
			<div class="section-header">
				<h2>Featured Videos</h2>
				<a href="/videos" class="view-all"><i class="fas fa-chevron-right"></i> View All Videos</a>
			</div>
			<div class="media-grid">
    {featuredVideos.map((videos) => (
    <a href={`/video/${videos.id}`} class="media-card">
        
        <div class="card-image skeleton">
            <img src={`/${videos.thumbnail}`} alt={videos.title} loading="lazy" />
            <div class="play-icon"><i class="fas fa-play"></i></div>
        </div>

        <div class="card-info">
            <h3>{videos.title}</h3>
            <p class="text-muted">{videos.category}</p>
        </div>
    </a>
    ))}
</div>
		</div>
	</section>

	<section id="photo" class="featured-section reveal">
		<div class="container">
			<div class="section-header">
				<h2>Featured Photos</h2>
				<a href="/photos" class="view-all"><i class="fas fa-chevron-right"></i> View Gallery</a>
			</div>
			<div class="media-grid">
				{featuredPhotos.map((photo) => (
				<a href={photo.full} class="media-card lightbox-trigger"
					data-caption={`<strong>${photo.title}</strong><br>${photo.description}<br><span class="meta">${photo.camera} &bull; ${photo.date}</span>`}>
					<div class="card-image skeleton">
						<img src={photo.thumb} alt={photo.title} loading="lazy" />
						<div class="photo-icon"><i class="fas fa-expand"></i></div>
					</div>

					<div class="card-info">
						<h3>{photo.title}</h3>
						<p class="text-muted">{photo.category}</p>
					</div>
				</a>
				))}
			</div>
		</div>
	</section>

	<section class="services-teaser reveal">
		<div class="container">
			<div class="section-header">
				<h2>Capabilities</h2>
				<a href="/about" class="view-all">More About Me</a>
			</div>
			<div class="grid-3">
				<div class="service-item">
					<i class="fas fa-film text-accent service-icon"></i>
					<h3>Video Production</h3>
					<p class="text-muted text-sm">End-to-end editing using Premiere Pro and Davinci Resolve Studio. Also
						proficient at color
						grading, motion tracking, and
						narrative storytelling that retains viewer attention.</p>
				</div>
				<div class="service-item">
					<i class="fa-solid fa-pen-nib text-accent service-icon"></i>
					<h3>Motion Design & Branding</h3>
					<p class="text-muted text-sm">Bringing static assets to life. 2D/3D animation, text animation, logo reveals, and
						composite visual effects, including rotoscoping, using After Effects, Cinema4D, and Unreal Engine.</p>
				</div>
				<div class="service-item">
					<i class="fa-solid fa-mobile-screen-button text-accent service-icon"></i>
					<h3>Web & Digital Strategy</h3>
					<p class="text-muted text-sm">Building the platform and the audience. Custom responsive websites
						(HTML/CSS), SEO optimization, Email marketing and data-driven social
						media campaigns.</p>
				</div>
			</div>
		</div>
	</section>


	<section class="cta-banner">
		<div class="container text-center reveal">
			<h2 class="mb-4">Let’s Make Something Awesome.</h2>
			<p class="text-muted mb-8 max-w-2xl mx-auto">
				You bring the vision, I’ll bring the engine room. Whether it's video production, 
				web dev, or digital strategy, let's build something that stands out.
			</p>
			
			<a href="#" 
			class="btn-primary contact-trigger" 
			data-user="chuck" 
			data-domain="chuckcopeland.com">
			Let's Work Together
			</a>
		</div>
	</section>
	</div>

<script>
    let lightbox: any = null;

    function initLightbox() {
        const gallerySelector = '.media-grid a.lightbox-trigger';
        if (!document.querySelector(gallerySelector)) return;

        if (lightbox) {
            lightbox.destroy();
            lightbox = null;
        }

        lightbox = new SimpleLightbox(gallerySelector, {
            captions: false,
            captionSelector: 'self',
            captionType: 'attr',
            captionsData: 'data-caption',
            captionPosition: 'bottom',
            captionDelay: 0,
            animationSpeed: 250,
            fadeSpeed: 300,
        });

// Caption animation logic
        const hideCaption = () => {
            const caption = document.querySelector('.sl-caption');
            // FIX: Check if it is an HTMLElement before accessing .style
            if (caption instanceof HTMLElement) {
                caption.style.opacity = '0';
            }
        };

        const showCaption = () => {
            const caption = document.querySelector('.sl-caption');
            // FIX: Check here as well
            if (caption instanceof HTMLElement) {
                setTimeout(() => {
                    caption.style.transition = 'opacity 0.1s';
                    caption.style.opacity = '1';
                }, 50);
            }
        };

        // Watermark Logic
        const addWatermark = () => {
            const imgContainer = document.querySelector('.sl-image');
            if (imgContainer && !imgContainer.querySelector('.sl-watermark')) {
                const img = document.createElement('img');
                img.src = '/assets/img/watermark.png';
                img.className = 'sl-watermark';
                img.alt = 'Watermark';
                imgContainer.appendChild(img);
            }
        };

        lightbox.on('open.simplelightbox', hideCaption);
        lightbox.on('next.simplelightbox', hideCaption);
        lightbox.on('prev.simplelightbox', hideCaption);
        lightbox.on('opened.simplelightbox', showCaption);
        lightbox.on('nextImageLoaded.simplelightbox', showCaption);
        lightbox.on('prevImageLoaded.simplelightbox', showCaption);

        // Attach Watermark Events
        lightbox.on('opened.simplelightbox', addWatermark);
        lightbox.on('nextImageLoaded.simplelightbox', addWatermark);
        lightbox.on('prevImageLoaded.simplelightbox', addWatermark);
    }

    function destroyLightbox() {
        if (lightbox) {
            lightbox.destroy();
            lightbox = null;
        }
    }

    document.addEventListener('astro:page-load', initLightbox);
    document.addEventListener('astro:before-swap', destroyLightbox);
</script>

</Layout>

<style>
	.index-page {
		cursor: default;
	}
	
	/* HERO STYLES (Unchanged) */
	.hero {
		position: relative;
		height: 95vh;
		width: 100%;
		overflow: hidden;
		display: flex;
		align-items: center;
	}

	.hero-video {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		z-index: 0;
	}

	.hero-overlay {
		position: absolute;
		inset: 0;
		background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), #0a0a0a);
		z-index: 1;
	}

	.hero-content {
		position: relative;
		z-index: 2;
		margin-top: 5rem;
		text-align: center;
		width: 100%;
	}

	.hero-subtitle {
		font-size: clamp(0.9rem, 1vw + 0.5rem, 1.4rem);
		letter-spacing: 2px;
		text-transform: uppercase;
		line-height: 1.6;
		font-weight: 300;
		opacity: 0.8;
		max-width: 800px;
		margin: 1rem auto 2rem;
	}

	/* SECTIONS */
	.featured-section {
		padding: 5rem 0;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 2rem;
		border-bottom: 1px solid #222;
		padding-bottom: 1rem;
		gap: 1rem;
	}

	.section-header h2 {
		margin-bottom: 0;
		line-height: 1;
	}

	.view-all {
		color: var(--text-muted);
		font-family: var(--font-heading);
		font-size: clamp(0.9rem, 1vw + 0.2rem, 1.1rem);
		display: inline-block;
		text-align: right;
	}

	.view-all:hover {
		color: var(--accent);
	}

	.media-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 2rem;
	}

	@media (min-width: 768px) {
		.media-grid {
			grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
		}
	}

	.media-card {
		display: block;
		position: relative;
		background: var(--bg-card);
		border-radius: 8px;
		overflow: hidden;
		transition: transform 0.3s ease;

		/* THIS FORCES THE 16:9 RATIO ON THE WHOLE CARD CONTAINER */
		/* Note: We actually apply aspect ratio to the image container 
           to ensure the text sits below it nicely */
	}

	.media-card:hover {
		transform: translateY(-5px);
	}

	.card-image {
		position: relative;
		width: 100%;

		/* THE MAGIC RATIO: */
		aspect-ratio: 16 / 9;

		overflow: hidden;
	}

	.card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		/* This crops the photos to fill the 16:9 box */
		transition: transform 0.5s ease;
	}

	.media-card:hover .card-image img {
		transform: scale(1.05);
	}

	/* ICONS (Play for Video, Expand for Photo) */
	.play-icon,
	.photo-icon {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		background: rgba(0, 0, 0, 0.6);
		border-radius: 50%;
		width: 50px;
		height: 50px;
		display: flex;
		align-items: center;
		justify-content: center;
		opacity: 0;
		transition: opacity 0.3s ease;
		backdrop-filter: blur(4px);
		color: #fff;
		z-index: 3;
	}

	.media-card:hover .play-icon,
	.media-card:hover .photo-icon {
		opacity: 1;
	}

	.card-info {
		padding: 1.2rem;
		border-top: 1px solid rgba(255, 255, 255, 0.05);
	}

	.card-info h3 {
		font-size: 1.1rem;
		color: var(--text-main);
		margin-bottom: 0.25rem;
	}

	.card-info p {
		font-size: 0.8rem;
		text-transform: uppercase;
		letter-spacing: 1px;
	}

	/* NEW STYLES */
	.trusted-section {
		padding: 4rem 0;
		background: #0f0f0f;
	}

	.trusted-section h2 {
		padding: 0 0 1rem 0;
	}
	.services-teaser {
		padding: 4rem 0;
		background: var(--bg-card);
		/* Distinct background to break up the page */
	}

	.grid-3 {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
		gap: 2rem;
	}

	@media(min-width: 768px) {
		.grid-3 {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	.service-item {
		padding: 2rem;
		background: var(--bg-main);
		border: 1px solid #222;
		border-radius: 8px;
		transition: transform 0.3s ease, border-color 0.3s ease;
		text-align: center;
	}

	.service-item:hover {
		transform: translateY(-5px);
		border-color: var(--accent);
	}

	.service-icon {
		font-size: 2.5rem;
		margin-bottom: 1.5rem;
		display: inline-block;
	}

	.service-item h3 {
		font-size: 1.25rem;
		margin-bottom: 1rem;
		color: var(--text-main);
	}

	.service-item p {
        font-size: 0.95rem;
        color: #ccc;
        margin-bottom: 1.5rem;
        line-height: 1.6;
	}

	.cta-banner {
		padding: 4rem 0;
		background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('/assets/img/sunset-farm.webp');
		background-size: cover;
		background-position: center;
		text-align: center;
	}

	/* Centering helper for CTA */
	.mx-auto {
		margin-left: auto;
		margin-right: auto;
	}

	.max-w-2xl {
		max-width: 42rem;
	}

	.mb-4 {
		margin-bottom: 1rem;
	}

	.mb-8 {
		margin-bottom: 2rem;
	}

	/* Photo Carousel Styles */
	.swiper-slide a {
		display: block;
		position: relative;
		overflow: hidden;
		border-radius: 8px;
		aspect-ratio: 16 / 9;
	}
	.swiper-slide img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.4s ease;
	}
	.swiper-slide a:hover img {
		transform: scale(1.05);
	}
	.photo-overlay {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		padding: 1rem;
		background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
		display: flex;
		align-items: flex-end;
	}
	.category-badge {
		background: var(--accent);
		color: #fff;
		padding: 0.3rem 0.6rem;
		border-radius: 4px;
		font-size: 0.75rem;
		font-weight: bold;
		text-transform: uppercase;
	}
	.swiper-button-next, .swiper-button-prev {
		color: var(--accent);
		--swiper-navigation-size: 2rem;
	}

    /* Lightbox Watermark */
    :global(.sl-watermark) {
        position: absolute;
        top: 3%;
        left: 50%;
        transform: translate(-50%, -50%);
        height: 25px !important;
        width: auto !important;
        z-index: 10000;
        opacity: 0.4;
        pointer-events: none;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
</style>